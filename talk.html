<html>
<head>
  <title>JavaScript and single page applications</title>
  <style type="text/css">
    body {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  color: #444;
  background-color: #aaa;
}

#wrapper {
  width: 850px;
  height: 600px;
  overflow: hidden;
  margin: 80px auto 0 auto;
  box-shadow: 3px 3px 3px #666;
  background-color: #eee;
}

.slide {
  width: auto;
  height: 540px;
  padding: 30px;
  font-weight: 200;
  font-size: 32px;
  line-height: 44px;
}

#controls {
  width: 850px;
  margin: -60px auto 0 auto;
}

#controls div {
  width: 50px;
  height: 50px;
  padding: 5px 50px;
  font-size: 36px;
  background-color: #ccc;
}

#controls div:hover {
  background-color: #bbb;
  cursor: pointer;
}

#controls #prev {
  float: left;
  -webkit-border-top-right-radius: 20px;
  -moz-border-radius-topright: 20px;
  border-top-right-radius: 20px;
}

#controls #next {
  float: right;
  text-align: right;
  -webkit-border-top-left-radius: 20px;
  -moz-border-radius-topleft: 20px;
  border-top-left-radius: 20px;
}

.slide h1 {
  font-size: 100px;
  text-align: center;
  margin-top: 200px;
  margin-bottom: 30px;
}

.slide h2 {
  font-size: 30px;
  text-align: center;
  font-weight: 200;
}

.slide h3 {
  font-size: 45px;
  border-bottom: 1px solid #aaa;
  margin: 0;
  padding-bottom: 15px;
}

.slide ul {
  padding: 20px 0 0 60px;
  font-weight: 200;
  font-size: 32px;
  line-height: 44px;
}

.slide .author h1.name {
  font-size: 55px;
  font-weight: 200;
  text-align: center;
  margin-top: 185px;
  margin-bottom: 30px;
}

.slide .author h3 {
  font-weight: 100;
  text-align: center;
  font-size: 30px;
  border: none;
}

a {
  text-decoration: none;
  color: #44a4dd;
}

a:hover {
  color: #66b5ff;
}

code {
  background-color: #ccc;
}

pre > code {
  background-color: inherit;
  font-size: 60%;
  line-height: 1.3;
}

.hidden {
  display: none;
}


    
  </style>
  <link rel="stylesheet" type="text/css" href="styles/highlight.css">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <div id="wrapper">
      <section class="slide"><h1>Web apps</h1>

<h2>JavaScript and single page applications</h2>

<h2>Peter Janakiev</h2>

<h2><a href="mailto:regardingscot@gmail.com">regardingscot@gmail.com</a></h2></section>
      <section class="slide"><h3>What is a "single page application"?</h3>

<ul>
<li>An application that loads only once in the browser and from then on user interaction is conducted without ever leaving the page</li>
<li>Usually involves a lot of JavaScript</li>
<li>Lots of "widgets" and "custom elements"</li>
</ul></section>
      <section class="slide"><h3>What is a large scale JavaScript program?</h3>

<ul>
<li>More than 100,000 LOC</li>
<li>More than 2 developers</li>
<li>Mostly everything you see from Google as well as Facebook, NYT web view, Meebo, Imo.im, Flowdock etc.</li>
</ul></section>
      <section class="slide"><h3>Combined?</h3>

<ul>
<li>'Native like' behaviour in the browser.</li>
<li>Full control of user interaction.</li>
<li>Off-line</li>
<li>On your desktop (Chrome apps)</li>
<li>Access to hardware</li>
<li>and more..</li>
</ul></section>
      <section class="slide"><h3>History</h3>

<p>The SPA circa 1999</p>

<h2><img src="admin-console.jpg" alt="" title="" /></h2></section>
      <section class="slide"><h3>History</h3>

<p>Code looked like this:</p>

<pre><code>&lt;html&gt;
  &lt;script src="..."&gt;&lt;/script&gt;
  ...x20
&lt;body&gt;
&lt;iframe id=".."&gt;
  ...
  &lt;div onclick="globalFnName();" onhover="top[framename].method"&gt;&lt;/div&gt;
  ...
&lt;/iframe&gt;
&lt;iframe id=".."&gt;&lt;/iframe&gt;
&lt;iframe id=".."&gt;&lt;/iframe&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></section>
      <section class="slide"><h3>History</h3>

<p>Mostly a mess of tricks and quirks:</p>

<pre><code>document.write('&lt;iframe src="script.js"&gt;&lt;/iframe&gt;')

document.write('&lt;script&gt;....&lt;/scr' + 'ipt&gt;');

window.onload=function() {
  top[framename].globalReference[0].method();
};

document.write('&lt;object id="KJDSYWUEWDJNWKHDKW32DHWD"&gt;&lt;/object&gt;');
// The id is fake, but using the right ID will render
// ActiveX text edit control in IE&lt;8
</code></pre></section>
      <section class="slide"><h3>History</h3>

<p>New bread of apps (Gmail): (circa 2005)</p>

<h2><img src="gmail.jpg" alt="" title="" /></h2></section>
      <section class="slide"><h3>History</h3>

<p>Google decides to rock the web by reinventing the JS programming</p>

<p>Develops Closure tools in-house and uses it to refocus Java devs to JavaScript</p>

<pre><code>/**
 * @constructor
 * @extends {goog.ui.Control}
 * @param {goog.dom.DomHelper=} opt_domHelper
 * @param {goog.ui.ControlRenderer=} opt_renderer
 */
goog.ui.widget.Calendar = function(opt_domHelper, opt_renderer) {
  ...
};
</code></pre></section>
      <section class="slide"><h3>History</h3>

<p>During the same time in the wild:</p>

<ul>
<li>jQuery</li>
<li>MooTools</li>
<li>Prototype</li>
</ul></section>
      <section class="slide"><h3>History</h3>

<h2>Lets make developers life easier:</h2>

<p>jQuery</p>

<pre><code>$('myclassname[type="password"]').on('click', function() {..});
</code></pre>

<p>Made it much easier to deal with browsers and allowed to start thinking more for the app logic and less for the host system.</p></section>
      <section class="slide"><h3>History</h3>

<h2>Mootools - Makes inheritance and mixins easier:</h2>

<pre><code>myClass = new Class({
  Extends: [],
  Implements: [],
  initialize: function() {}, // same as constructor function
  method1: function() {},
  method2: function() {
    this.parent(); // call parent method
  }
});
// Usage
new myClass();
</code></pre></section>
      <section class="slide"><h3>History</h3>

<h2>The new kind of apps (full screen, very interactive)</h2>

<h2><img src="famous.jpg" alt="" title="" /></h2></section>
      <section class="slide"><h3>History</h3>

<h2>Physics engine (base for 2d games)</h2>

<h2><img src="box2d.jpg" alt="" title="" /></h2></section>
      <section class="slide"><h3>History</h3>

<p>2009 - 2012</p>

<p>ES5, Array methods, shims and polifils become the base for larger projects and frameworks</p>

<p>Vendors start to implements all sort of interesting features to make it easier to develop interactive experiences</p></section>
      <section class="slide"><h3>History</h3>

<ul>
<li>CSS3 - transform, translate, filters, shaders, SVG filters etc.</li>
<li>WebWorkers - CPU intensive tasks</li>
<li>ArrayBuffers</li>
<li>FileAPI</li>
<li>Canvas</li>
<li>Video / Audio</li>
<li>WebGL</li>
<li>WebSocket (tcp -> latency).</li>
<li>localStorage, webSQL, IndexedDB</li>
</ul></section>
      <section class="slide"><h3>History</h3>

<p>Companies start developer outreach:</p>

<ul>
<li><a href="http://addyosmani.com/largescalejavascript/">Patterns for large scale JS apps</a> - Google</li>
<li><a href="http://developer.nokia.com/Community/Wiki/JavaScript_Performance_Best_Practices">JavaScript performance best practices</a> - Nokia</li>
<li>and mode (Adobe, Microsoft etc).</li>
</ul></section>
      <section class="slide"><h3>Present</h3>

<p>Data binding: Backbone, AngularJS, Ember - one problem, many solutions, mostly incompatible.</p>

<ul>
<li>Useful for data presentation and partially for data interaction models.</li>
<li>Not very useful for other class of problems (video, audio, images, design, cad/cam etc)</li>
</ul></section>
      <section class="slide"><h3>Present</h3>

<p>Polymer / Brick - custom sets of polyfils and elements for the Web Components.</p>

<ul>
<li>Too idealistic (everything is an Element, including your ajax requests)</li>
<li>Should be responsive and work on touch (but it does not).</li>
<li>Still it is not clear how it will fit in what we know as best practices from the last 10 years.</li>
</ul></section>
      <section class="slide"><h3>Present</h3>

<ul>
<li>[fame.us] - custom rendering infrastructure (based on transforms with matrix3d)</li>
<li>webGL - custom user interfaces (world of Oz)</li>
<li>games - canvas with sprites and interface with game controlers + fullscreen</li>
<li>[SkyDrive.com] - M$ Excel and Word for the web</li>
<li>AppScript - JavaScript for Google applications</li>
<li>Emscripten - C/C++ compiled to asm.js (or ArrayBuffers)</li>
<li>LLJS - low level JavaScript (ArrayBuffers and manual memory management)</li>
</ul></section>
      <section class="slide"><h3>The future</h3>

<p>Mostly Web Components</p>

<pre><code>&lt;pdf src="mybook.pdf"&gt;&lt;/pdf&gt;

// or

&lt;webglgame resume="true"&gt;&lt;/webglgame&gt;

// or

&lt;excel sheet="mydocument" on-change="saveToCloud"&gt;&lt;/excel&gt;
</code></pre>

<p>Framework to bind them all: use what you already know - DOM, events, splinkle JS here and there.</p></section>
      <section class="slide"><h3>Today</h3>

<p>Lots of tools for lots of tasks:</p>

<ul>
<li>requireJS - deps management</li>
<li>backbone - data binding and synchronization</li>
<li>jquery (or alternative) for browser compat</li>
<li>polyfils for Video/Audio/sockets etc.</li>
<li>less/sass</li>
<li>lots of plugins and libraries for specific tasks</li>
</ul>

<p>(more than 50 solutions for charts alone!)</p></section>
      <section class="slide"><h3>Today</h3>

<p>The developer is reading most of the time and trying to make things work together. In lots of tasks there is a solution around the corner and with a little more reading / tweaking it can just work...</p></section>
      <section class="slide"><h3>Today</h3>

<p>What about tasks that there is not solution ready for us?</p>

<p>There comes the "ninja" (no, not THAT "ninja")!</p></section>
      <section class="slide"><h3>Today</h3>

<p>The developer should consider much more than the language itself.</p>

<ul>
<li>number of requests</li>
<li>selector complexity</li>
<li>dependency management (for JS and for CSS)</li>
<li>templating language</li>
<li>backend / frontend rendering</li>
<li>SEO for SPA (what??)</li>
<li>source code control</li>
<li>automation and testing</li>
</ul></section>
      <section class="slide"><h3>Today</h3>

<h2>How did we got here?</h2>

<h2>Technology evolution.</h2></section>
      <section class="slide"><h3>Ajax</h3>

<p>AJAX - Initially used for XML with XSLT in the browser (as designed by MicoSoft)</p>

<p><a href="www.backbase.com/portal-software">www.backbase.com/portal-software</a> - Initially developed an Ajax library trying to sell it, later reorganized into portal software and later still specialized in banking business.</p>

<p>Today still uses XSLT to operate on data. Good news is Web Component.</p>

<p>Other legacy software.</p></section>
      <section class="slide"><h3>Ajax for XML (how did it work)</h3>

<ul>
<li>Fetch the xml and the xsl, transform the root node and insert it in the document.</li>
<li>Deigned for viewing data, not interacting (innerHTML, replace/add node).</li>
<li>Poor support in non-IE browsers.</li>
</ul></section>
      <section class="slide"><h3>Ajax + JSON</h3>

<p>JSON - structured serilization of data that can be parsed right into live JS objects</p>

<p>Circa 2006</p>

<p>Google's products</p>

<ul>
<li>eval</li>
<li>later - JSON.parse</li>
</ul>

<p>Much better than XML, but basically used the same ways initially (parse, render using DOM APIs)</p></section>
      <section class="slide"><h3>Ajax and binary</h3>

<p>ProtoBuffers</p>

<p>Lazy parse, multiple serialization formats (Google still uses string serialization for compatibility with older browsers).</p></section>
      <section class="slide"><h3>Realtime</h3>

<p>WebSocket - text and binary</p>

<p>TCP is not UDP!</p></section>
      <section class="slide"><h3>Frameworks (2008-...)</h3>

<p>The monoliths</p>

<ul>
<li>dojo</li>
<li>YUI</li>
<li>other..</li>
</ul></section>
      <section class="slide"><h3>Frameworks (2011-...)</h3>

<p>Data binding: one way, two way, sync</p>

<p>Backbone, Meteor, AngularJS, Ember etc.</p></section>
      <section class="slide"><h3>Instrumentation</h3>

<h2>Know your tools! Love your compiler!</h2></section>
      <section class="slide"><h3>Closure compiler</h3>

<p>Developed in-house, uses Rhino to parse ES4 style comments and creates AST.</p>

<ul>
<li>Its Java</li>
<li>Understands only a small subset of the language</li>
<li>Tree-shaking and inlining / renaming - win (for those who are willing to rewrite all).</li>
</ul>

<p>Do not blindly trust the experts!</p></section>
      <section class="slide"><h3>JS loaders and minifiers</h3>

<p>Circa 2008-2009 more than a dozen of them in the wild with different rate of usefulness.</p>

<p>Lots of "custom" loader code (pretty much the same as 'document.write')</p>

<p>White space stripping is considered 'minification'.</p>

<p>Needed solution because projects get bigger and bigger.</p></section>
      <section class="slide"><h3>UglifyJS and RequireJS</h3>

<p>Made possible by nodejs (4 years ago - 2009).</p>

<p>While still no concensus on it, pretty much the standard.</p>

<p>More than white space removal - real AST of the code.</p>

<p>No cencensus on the "right" module pattern (AMD vs CommonJS)</p></section>
      <section class="slide"><h3>In style</h3>

<p>Less, Sass, Gss.. - make your pick.</p>

<p>Templates - basically the same old story (will probably change with Web Components).</p>

<p>Much better than JS (but still manual dependency management and no straight forward way to require css from code logic)</p></section>
      <section class="slide"><h3>Popular kids on the block</h3>

<ul>
<li>Bower</li>
<li>Yeoman</li>
<li>HTML5 boilerplate</li>
<li>Bootstrap</li>
<li>jQuery UI / jQuery Mobile</li>
</ul>

<h2>Pretty much you are set... unless you are building a new UX/interaction</h2></section>
      <section class="slide"><h3>Back to the present</h3>

<h2>Wellcome to 2013 - everything is "mobile first".</h2>

<h2>Its like the 2005, same CPU / RAM available, but this time we have GPU. Unless we dont.</h2></section>
      <section class="slide"><h3>UX/Interaction</h3>

<p>What to do when the solution is simply not there?</p>

<ul>
<li>grasp as much of what is out there as possible</li>
<li>strategize (style?)</li>
<li>choose solution (benchmarking)</li>
<li>backward compat?</li>
</ul></section>
      <section class="slide"><h3>History</h3>

<h2>How some companies did it?</h2></section>
      <section class="slide"><h3>Netflix</h3>

<p>Largest content provider in the US.</p>

<p>Client for all major platforms (including game consoles, handhels etc).</p>

<p>Decided to go with WebKit.</p></section>
      <section class="slide"><h3>Netflix - not so fast!</h3>

<p>The solution seemed easy - modern rendering engine with modern JS engine - win!</p>

<p>Not really - very low powered, very memory contrained. It simply did not work.</p></section>
      <section class="slide"><h3>Netflix - solving it.</h3>

<ul>
<li>Use of transforms and translations.</li>
<li>Reuse DOM nodes</li>
<li>Reuse JS Objects (Pooling)</li>
</ul>

<p>"Infinite" scroll behavior.</p>

<p><a href="http://techblog.netflix.com/search/label/HTML5">Netflix and webUI</a></p></section>
      <section class="slide"><h3>Netflix - conclusion</h3>

<p>You cannot simply visualize 10,000+ items and expect every device to behave.</p>

<p>We still use tricks and optimizations (just like in the old days).</p>

<p>However we have understanding of structure, reusability patterns and testing.</p></section>
      <section class="slide"><h3>Can we use it?</h3>

<p>Yes, you can!</p>

<p>Example: <a href="longa.com/cgi-bin/if.cgi?run=mtvapp&amp;nstableview">longa.com/cgi-bin/if.cgi?run=mtvapp&amp;nstableview</a></p></section>
      <section class="slide"><h3>Google - animation and image loading.</h3>

<p>GPU acceleration for your animations (translate3d).</p>

<p>Layer invalidation?</p>

<p>What can we do about it?</p></section>
      <section class="slide"><h3>Google &amp; Microsoft</h3>

<p>NextTick - execute code right after the exit of our call stack</p>

<p>What is wrong with setTimeout(function() {}, <em>0</em>)</p>

<p><a href="http://jsperf.com/settimeout-vs-nexttick-polyfill">jsperf - setTimeout vs nextTick</a></p>

<p><a href="https://code.google.com/p/closure-library/source/browse/closure/goog/async/nexttick.js">nexttick.js</a></p>

<p>Be careful with jsPerf!</p></section>
      <section class="slide"><h3>Mozilla - we will not support h264!</h3>

<p>But we have asm.js - just compile your decoder, please:-)</p>

<p><a href="https://github.com/mbebenita/Broadway">Broadway</a> - H264 decoder in JavaScript.</p>

<p>Emscripten (no, it is not handwritten)</p></section>
      <section class="slide"><h3>Facebook vs Sencha</h3>

<p>Facebook - html5 / js is a failure.</p>

<p>Sencha - no it is not, its just that you cannot do it right!</p>

<p><a href="http://www.sencha.com/blog/the-making-of-fastbook-an-html5-love-story">HTML5 love story</a></p></section>
      <section class="slide"><h3>A word for Facebook</h3>

<ul>
<li>Everyday release (first popularized by Google) - lots of broken stuff but lots of new features and hot fixes.</li>
<li>React framework - a little too late, but a few good ideas.</li>
<li>Already implemented in all major frameworks.</li>
</ul></section>
      <section class="slide"><h3>Examples!</h3>

<h2><img src="math1.png" alt="" title="" /></h2></section>
      <section class="slide"><h3>Examples!</h3>

<h2><img src="math2.png" alt="" title="" /></h2></section>
      <section class="slide"><h3>Examples</h3>

<h2>Should be done right!</h2></section>
      <section class="slide"><h3>Lets get to work!</h3>

<ul>
<li>What is <em><strong>RAF</strong></em></li>
<li>What is <em><strong>setImmediate</strong></em></li>
<li>Why should we care</li>
</ul></section>
      <section class="slide"><h3>Developer console</h3>

<h2>Know your tools!</h2>

<pre><code>alert('Debug me!');
</code></pre>

<p>Network activity, timeline, frames, JS mem stack, CPU profiles and more</p></section>
      <section class="slide"><h3>Exercise 1</h3>

<p><a href="https://github.com/ouhouhsami/timeline-js">Timeline js</a></p>

<ul>
<li>very simple</li>
<li>clean code</li>
<li>lots of opportunities for optimization</li>
</ul></section>
      <section class="slide"><h3>Exercise 1</h3>

<p>Download the code</p>

<pre><code>git clone URL
</code></pre>

<p>Repo: <a href="http://goo.gl/It9NfL">http://goo.gl/It9NfL</a></p>

<pre><code>exercise/1/index.html
</code></pre></section>
      <section class="slide"><h3>Exercise 2</h3>

<p>NSTableView</p>

<ul>
<li>Implementation for the browser</li>
<li>Sencha, Netflix, etc.</li>
<li>Applications?</li>
</ul></section>
      <section class="slide"><h3>Excercise 2</h3>

<pre><code>exercise/2/index.html
</code></pre>

<p>How to improve it?</p>

<ul>
<li>Try making the cell taller and add image(s).</li>
<li>Scheduled rasterization (raf or nexttick?).</li>
</ul></section>
      <section class="slide"><h3>Other exercises</h3>

<p>Google+ photo view <a href="http://goo.gl/Z0tYxW">http://goo.gl/Z0tYxW</a></p>

<p>Google+ communities / profile page with lots of entries (Scienece on G+)</p></section>
      <section class="slide"><h1>Questions?</h1>

<h2>Get in touch</h2>

<h2><a href="">gtalk:regardingscot@gmail.com</a></h2></section>
  </div>
  <script type="text/javascript">
    /**
 * Takes the last slide and places it at the front.
 */
function goBack() {
  var wrapper = document.querySelector('#wrapper');
  var lastSlide = wrapper.lastChild;
  while (lastSlide != null && lastSlide.nodeType !== 1) {
    lastSlide = lastSlide.previousSibling;
  }

  wrapper.removeChild(lastSlide);
  wrapper.insertBefore(lastSlide, wrapper.firstChild);
}

/**
 * Takes the first slide and places it at the end.
 */
function goForward() {
  var wrapper = document.querySelector('#wrapper');
  var firstSlide = wrapper.firstChild;
  while (firstSlide != null && firstSlide.nodeType !== 1) {
    firstSlide = firstSlide.nextSibling;
  }

  wrapper.removeChild(firstSlide);
  wrapper.appendChild(firstSlide);
}

window.onload = function () {

  document.onkeydown = function (e) {
    var kc = e.keyCode;

    // left, down, H, J, backspace - BACK
    // up, right, K, L, space, enter - FORWARD
    if (kc == 37 || kc == 40 || kc == 8 || kc == 72 || kc == 74) {
      goBack();
    } else if (kc == 38 || kc == 39 || kc == 13 || kc == 32 || kc == 75 || kc == 76) {
      goForward();
    }
  }

  if (document.querySelector('#next') && document.querySelector('#prev')) {
    document.querySelector('#next').onclick = function (e) {
      e.preventDefault();
      goForward();
    }

    document.querySelector('#prev').onclick = function (e) {
      e.preventDefault();
      goBack();
    }
  }

}

  </script>
  <script src="hilight.min.js"></script>
  <script>
  hljs.initHighlightingOnLoad();
  </script>
</body>
</html>
